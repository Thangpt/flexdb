--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'DFDEAL';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('DFDEAL','Tiểu khoản DF','Deal information','select v.*,cd.cdcontent DEALTYPE_DESC,
  v.PRINNML+STSTERM.INTNMLACRTERM+v.INTDUE+STSTERM.FEEINTNMLACRTERM+v.FEEINTDUE+v.OPRINNML+v.OINTNMLACR+v.OINTDUE+v.FEE+v.FEEDUE -nvl(sts.NML,0) INDUEAMT,
  nvl(sts.NML,0) DUEAMT, v.PRINOVD+v.INTOVDACR+v.INTNMLOVD+v.FEEINTOVDACR+v.FEEINTNMLOVD+v.OPRINOVD+v.OINTOVDACR+v.OINTNMLOVD+v.FEEOVD OVERDUEAMT,
  mst.EXPDATE, (CASE WHEN TYP.NINTCD=''000'' THEN 1 ELSE 0 END) FLAGINTACR, -- N?U LÃ€ 000 LÃ€ CÃCH TÃNH NHU CU
  0 INTDAY,
  0 INTOVDDAY,
  STSTERM.INTNMLACRTERM+STSTERM.FEEINTNMLACRTERM+ v.OINTNMLACR + v.OINTOVDACR + v.INTOVDACR +V.FEEINTOVDACR INTACR, greatest(v.INTAMTACR+v.feeamt,v.FEEMIN-v.RLSFEEAMT) DEALFEEAMT,
  (CASE WHEN MST.INTPAIDMETHOD <> ''L'' THEN 1 ELSE 0 END ) ISPAYINTIM,
  (CASE WHEN MST.INTPAIDMETHOD =''P'' THEN 1 ELSE 0 END) ISFLOATINT,
    to_date(mst.RLSDATE+mst.minterm,''DD/MM/YYYY'') mindate,
   nvl( ststerm.INTNMLACRTERM,0) INTNMLACRTERM,    nvl(ststerm.FEEINTNMLACRTERM,0) FEEINTNMLACRTERM,
    a1.cdcontent intpaidmethoddis
    from v_getDealInfo v, allcode cd, securities_info sb,
   (SELECT S.ACCTNO, SUM(NML) NML, M.TRFACCTNO FROM LNSCHD S, LNMAST M
          WHERE S.OVERDUEDATE = TO_DATE((select varvalue from sysvar where grname =''SYSTEM'' and varname =''CURRDATE''),''DD/MM/RRRR'') AND S.NML > 0 AND S.REFTYPE IN (''P'')
              AND S.ACCTNO = M.ACCTNO AND M.STATUS NOT IN (''P'',''R'',''C'')
          GROUP BY S.ACCTNO, M.TRFACCTNO
          ORDER BY S.ACCTNO) sts, lnmast mst, lntype typ, (select TO_DATE(VARVALUE,''DD/MM/RRRR'') currdate from sysvar where varname=''CURRDATE'') dt,
    (SELECT S.ACCTNO, ROUND(SUM(GREATEST(
    (CASE WHEN  S.RLSDATE+m.minterm < S.DUEDATE THEN nml*S.RATE1*M.MINTERM/100/360
    ELSE nml*S.RATE1*(S.DUEDATE-S.RLSDATE)/100/360+NML*S.RATE2/100/360*(to_date(S.RLSDATE+m.minterm,''DD/MM/YYYY'')-to_date(S.DUEDATE,''DD/MM/YYYY'')) END)
                      ,S.INTNMLACR)) ,4)INTNMLACRTERM,
           ROUND (SUM(GREATEST(
    (CASE WHEN  S.RLSDATE+m.minterm < S.DUEDATE THEN nml*S.cfRATE1*M.MINTERM/100/360
    ELSE nml*S.CFRATE1*(S.DUEDATE-S.RLSDATE)/100/360+NML*S.CFRATE2/100/360*(to_date(S.RLSDATE+m.minterm,''DD/MM/YYYY'')-to_date(S.DUEDATE,''DD/MM/YYYY'')) END)
                      ,S.FEEINTNMLACR)),4) FEEINTNMLACRTERM,
             M.TRFACCTNO
           FROM LNSCHD S, LNMAST M
          WHERE    S.REFTYPE IN (''P'')  AND s.acctno=m.acctno
          GROUP BY S.ACCTNO, M.TRFACCTNO
          ORDER BY S.ACCTNO) ststerm,
          ALLCODE A1
  where v.status=''A'' and v.lnacctno = sts.acctno (+) and v.codeid=sb.codeid AND V.GROUPID IS NULL
  and v.afacctno like nvl(''<$AFACCTNO>'',''%'') and mst.actype=typ.actype and v.lnacctno=mst.acctno
  and cd.cdname=''DFTYPE'' and cd.cdtype=''DF'' and cd.cdval=v.dftype
   AND  v.lnacctno = ststerm.acctno (+) and v.afacctno=ststerm.TRFACCTNO(+)
   and A1.cdtype=''LN'' and A1.cdname=''INTPAIDMETHOD'' and A1.cdval=mst.INTPAIDMETHOD
  ','DFMAST','frmCreateDFDeal',null,null,null,50,'N',0,null,'Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'DFDEAL';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (33,'TRADELOT','TRADELOT','C','DFDEAL',100,null,null,null,'N','N','N',100,null,'TRADELOT','N','47',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (32,'INTOVDDAY','INTOVDDAY','C','DFDEAL',100,null,null,null,'N','N','N',100,null,'INTOVDDAY','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (31,'INTDAY','INTDAY','C','DFDEAL',100,null,null,null,'N','N','N',100,null,'INTDAY','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (30,'FLAGINTACR','FLAGINTACR','C','DFDEAL',100,null,null,'#,##0','N','N','N',100,null,'FLAGINTACR','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (22,'DESCRIPTION','Diễn giải','C','DFDEAL',100,null,'LIKE,=',null,'Y','N','N',100,null,'Description','N','57',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (21,'FLAGTRIGGER','FLAGTRIGGER','C','DFDEAL',100,null,'LIKE,=',null,'N','N','N',100,null,'FLAGTRIGGER','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (20,'IDCODE','CMT/GPKD','C','DFDEAL',100,null,'LIKE,=',null,'Y','N','N',100,null,'Identify code','N','59',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (19,'ADDRESS','Địa chỉ','C','DFDEAL',100,null,'LIKE,=',null,'Y','N','N',100,null,'Address','N','58',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (18,'FULLNAME','Họ và tên','C','DFDEAL',100,null,'LIKE,=',null,'Y','N','N',100,null,'Fullname','N','57',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (17,'DEALFEEAMT','Phí của deal','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0.###0','Y','N','N',100,null,'Deal fee amount','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (16,'INTACR','Lãi cộng dồn','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0.###0','Y','N','N',100,null,'interest accure','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (15,'INDUEAMT','GT vay trong hạn','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0.###0','Y','N','N',100,null,'Indue amount','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (14,'DUEAMT','GT vay đến hạn','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'Due amount','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (13,'OVERDUEAMT','GT vay quá hạn','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'Over due amount','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (12,'DFTRADING','Số lượng được giao dịch','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'Available trading','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'CARCVQTTY','SL CK phong toả quyền chờ về','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'CA receiving','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (10,'RCVQTTY','SL CK phong toả chờ về','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'Receiving Quantity','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (9,'BLOCKQTTY','SL CK phong tỏa có DK','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'Block Quantity','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (8,'AFACCTNO','Số tiểu khoản','C','DFDEAL',120,null,'LIKE,=','_','Y','Y','N',100,null,'Account number','N','05',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'EXPDATE','Hạn trả nợ','D','DFDEAL',100,'__/__/____','=','##/##/####','Y','Y','N',70,null,'Expired date','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'RLSDATE','Ngày giải ngân','D','DFDEAL',100,'__/__/____','=','##/##/####','Y','Y','N',70,null,'Drawndown date','N','49',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (5,'ACCTNO','Tiểu khoản DF','C','DFDEAL',18,'cccc.cccccc.cccccc','LIKE,=','_','Y','Y','Y',100,null,'DF Account number','N','02',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (4,'AMT','GT vay gốc','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Amount','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (3,'DFQTTY','SL CK phong tỏa','N','DFDEAL',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'DF Quantity','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'SYMBOL','Chứng khoán','C','DFDEAL',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Symbol','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'DEALTYPE','Sản phẩm','C','DFDEAL',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Product','N','57',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (0,'CUSTODYCD','Số TK lưu ký','C','DFDEAL',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Custody code','N','88',null,'N',null,null,null,'N');
COMMIT;
/
