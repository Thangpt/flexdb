--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'CA3356';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('CA3356','Chuyển chứng khoán thực hiện quyền thành giao dịch - cả sự kiện (Giao dịch 3356)','Chuyển chứng khoán thực hiện quyền thành giao dịch(wait for 3356)','
select mst.*,se.qtty, (se.qtty-realqtty) diffqtty from (select max(mstautoid) AUTOID,camastid ,max(description) description, max(type) type,max(tradedate)tradedate,max(parvalue) parvalue,
max(price) price,sum(trade) trade,sum(blocked) blocked,max(CODEID) codeid, max(symbol) symbol, max(catype) catype,
sum(caqtty) caqtty,SUM(realqtty) realqtty,max(codeidwft) codeidwft
from (SELECT camast.autoid mstautoid,ca.autoid,camast.camastid, camast.description, ''001'' type,
camast.tradedate ,sb.parvalue, SE.costprice PRICE , CF.CUSTODYCD,CF.CUSTID,
 af.acctno AFACCTNO,SB.CODEID, cf.fullname,cf.idcode,cf.address,sb.symbol,se.STATUS,
AF.ACCTNO||SB.CODEID SEACCTNOCR,AF.ACCTNO||sbwft.CODEID SEACCTNODR,
least(ca.qtty,se.trade) TRADE ,(case when (ca.qtty>se.trade) then least((ca.qtty-se.trade),se.blocked) else 0 end) blocked,a1.cdcontent catype,
ca.qtty caqtty, (least(ca.qtty,se.trade) +  (case when (ca.qtty>se.trade) then least((ca.qtty-se.trade),se.blocked) else 0 end)) realqtty,
sbwft.codeid codeidwft
From vw_camast_all camast , vw_caschd_all ca,semast se ,afmast af,cfmast cf , sbsecurities sb ,sbsecurities sbwft, SECURITIES_INFO SEINFO,
allcode a1
where camast.camastid = ca.camastid
and camast.ISWFT=''Y'' and ca.ISSE=''Y''
and  nvl(camast.tocodeid,camast.codeid) = sb.codeid and ca.afacctno= se.afacctno
and se.afacctno = af.acctno and af.custid = cf.custid and sb.codeid = seinfo.codeid
and se.codeid = sbwft.codeid and sbwft.refcodeid=sb.codeid /* and se.trade+se.blocked>0*/
and a1.cdval=camast.catype and a1.cdname=''CATYPE'' and a1.cdtype=''CA''
and sbwft.tradeplace=''006'' and ca.status in(''C'',''S'',''G'',''H'',''J'')
and  instr(nvl(ca.pstatus,''A''),''W'') <=0
)
group by camastid) mst,
(SELECT codeid,SUM( se2.TRADE + se2.MORTAGE + se2.STANDING+se2.WITHDRAW+se2.DEPOSIT+se2.BLOCKED+se2.SENDDEPOSIT+se2.DTOCLOSE) qtty FROM semast se2 GROUP BY codeid) se where mst.codeidwft=se.codeid
','SEMAST','frmSEMAST','AUTOID DESC','3356',null,50,'N',30,'NYNNYYYNNN','Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'CA3356';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (24,'PRICE','Giá','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'PRICE','N','09',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (23,'PARVALUE','Mệnh giá','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',150,null,'Parvalue','N','11',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (18,'TRADEDATE','Ngày giao dich trở lại','D','CA3356',100,null,'=',null,'Y','Y','N',150,null,'Tx.Date','N','07',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (13,'CAQTTY','Tổng số phân bổ','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',150,null,'Available transfer','N','21',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (12,'QTTY','Tổng SL thực tế HT','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Available transfer','N','22',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'REALQTTY','Tổng SL chờ chuyển','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Available transfer','N','20',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (10,'BLOCKED','Tổng SL chờ chuyển PT','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Available transfer','N','19',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (9,'TRADE','Tổng SL chờ chuyển GD','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',150,null,'Available transfer','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'DIFFQTTY','Số chênh lệch','N','CA3356',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Available transfer','N','23',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'DESCRIPTION','Diễn giải sự kiện quyền','C','CA3356',200,'cccc.cccccc.cccccc','LIKE,=','_','Y','Y','N',200,null,'Camast ID','N','13',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (4,'TYPE','Loại','C','CA3356',50,null,'LIKE,=','_','N','Y','N',100,null,'Type','N','08',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'SYMBOL','Chứng khoán','C','CA3356',100,'ccccccccccccccc','LIKE,=','_','Y','Y','N',50,null,'Symbol','N','04',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'CATYPE','Loại thực hiện quyền','C','CA3356',100,null,'LIKE,=',null,'Y','Y','N',200,'SELECT CDVAL VALUE, CDCONTENT DISPLAY FROM ALLCODE WHERE CDTYPE = ''CA''
AND CDNAME = ''CATYPE'' AND CDUSER=''Y''  ORDER BY LSTODR','Coporate action type','N','05',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'CODEID','Chứng khoán','C','CA3356',100,'cccccc','LIKE,=','_','N','N','N',100,null,'Symbol','N','08',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (0,'CAMASTID','Mã sự kiện quyền','C','CA3356',100,'cccc.cccccc.cccccc','LIKE,=','_','Y','Y','N',150,null,'Camast ID','N','03',null,'N',null,null,null,'N');
COMMIT;
/
