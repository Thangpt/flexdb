--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'CF0046';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('CF0046','Tra cứu trạng thái tiểu khoản CK','View securities statement','
SELECT CF.CUSTODYCD, AF.ACCTNO,AF.ACTYPE, CF.FULLNAME,SB.SYMBOL,SB.BASICPRICE,SE.TRADE,SE.RECEIVING,NVL(B.MATCHEDAMT,0) MATCHEDAMT,NVL(B.REMAINQTTY,0) REMAINQTTY
FROM SEMAST SE,AFMAST AF,CFMAST CF,SECURITIES_INFO SB,
 (SELECT MAX(OD.SEACCTNO) SEACCTNO,af.acctno,SB.SYMBOL, SUM (CASE WHEN OD.EXECTYPE IN (''NS'',''SS'') THEN REMAINQTTY ELSE 0 END) REMAINQTTY,
  SUM(CASE WHEN OD.EXECTYPE IN (''NB'',''BC'') THEN EXECQTTY ELSE 0 END) MATCHEDAMT
  FROM ODMAST OD ,AFMAST AF, ODTYPE TYP,SYSVAR SYS,SECURITIES_INFO SB
 WHERE SYS.VARNAME=''CURRDATE'' AND SYS.GRNAME=''SYSTEM'' AND OD.CODEID=SB.CODEID AND
 OD.ACTYPE=TYP.ACTYPE AND AF.ACCTNO=OD.AFACCTNO AND  OD.TXDATE= TO_DATE(SYS.VARVALUE, ''DD\MM\YYYY'') AND DELTD <>''Y''
 group by af.acctno,SB.SYMBOL) B
 WHERE AF.ACCTNO=SE.AFACCTNO AND AF.CUSTID=CF.CUSTID AND SE.CODEID=SB.CODEID AND  SE.ACCTNO=B.SEACCTNO (+)
 AND se.TRADE + SE.RECEIVING+NVL(B.MATCHEDAMT,0) +NVL(B.REMAINQTTY,0)>0','CFMAST',null,null,null,null,50,'N',30,null,'Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'CF0046';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'REMAINQTTY','Bán chờ GT','N','CF0046',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Peding to release','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'MATCHEDAMT','Mua khớp','N','CF0046',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Matched buy','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'RECEIVING','Chờ về','N','CF0046',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Receiving','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'TRADE','Số dư GD','N','CF0046',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Trade','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (5,'BASICPRICE','Giá tham chiếu','N','CF0046',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Reference price','N','14',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (3,'FULLNAME','Tên khách hàng','C','CF0046',4,null,'LIKE,=','_','Y','Y','N',100,null,'Full name','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (3,'SYMBOL','Chứng khoán','C','CF0046',4,null,'LIKE,=','_','Y','Y','N',100,null,'Symbol','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'ACTYPE','Loại hình','C','CF0046',4,'9999','LIKE,=','_','Y','Y','N',100,null,'Account type','N','04',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'ACCTNO','Mã tiểu khoản','C','CF0046',4,'9999.999999','LIKE,=','_','Y','Y','N',100,null,'Account Number','N','03',null,'N',null,null,null,'N');
COMMIT;
/
