--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'CRBVOUCHERSE';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('CRBVOUCHERSE','Quản lý bảng kê CK','List of voucher management','
SELECT MST.AUTOID, MST.VERSION, MST.TXDATE, MST.AFFECTDATE, MST.REFBANK,MDL.SYMBOL,MDL.QTTY, MST.CREATETST, MST.SENDTST,
FN_CRB_GETVOUCHERNO(MST.TRFCODE, MST.TXDATE, MST.VERSION) VOUCHERNO,
A0.CDCONTENT DESC_STATUS, A1.CDCONTENT DESC_TRFCODE, ERR.ERRDESC,
DECODE(MST.STATUS,''P'',''Y'',''N'') APRALLOW, DECODE(MST.STATUS,''P'',''Y'',''N'') EDITALLOW
FROM CRBTRFLOG MST, ALLCODE A0, ALLCODE A1,DEFERROR ERR, (
    SELECT DTL.VERSION || DTL.TRFCODE || DTL.BANKCODE || TO_CHAR(DTL.TXDATE,''DDMMRRRR'') JOINKEY,
    DTL.VERSION,DTL.TRFCODE,DTL.BANKCODE,DTL.TXDATE,MAX(A.SYMBOL) SYMBOL, sum(QTTY) QTTY FROM
    (
        SELECT A.REQID,A.TRFCODE,MAX(A.SYMBOL_R) SYMBOL, MAX(A.QTTY) QTTY
        FROM
        (
        SELECT *
        FROM  (
          SELECT DTL.REQID,MST.TRFCODE, TXAMT QTTY, DTL.FLDNAME, NVL(DTL.CVAL,DTL.NVAL) REFVAL
          FROM   CRBTXREQ MST, CRBTXREQDTL DTL WHERE MST.STATUS<>''D''
          AND MST.REQID=DTL.REQID AND MST.TRFCODE IN (
            ''SETRFCLOSE'',''SESENDWITHDRAW'',''SESENDDEPOSIT'',
            ''SEREJECTWITHDRAW'',''SEREJECTDEPOSIT'',''SEODDLOT'',''SEODDLOC''
          )
        ) PIVOT  (MAX(REFVAL) AS R FOR (FLDNAME) IN (''SYMBOL'' as SYMBOL))
        ORDER BY REQID
        ) A GROUP BY A.REQID,A.TRFCODE
    ) A,CRBTRFLOGDTL DTL
    WHERE A.REQID=DTL.REFREQID
    GROUP BY DTL.VERSION,DTL.TRFCODE,DTL.BANKCODE,DTL.TXDATE
) MDL
WHERE A0.CDTYPE=''RM'' AND A0.CDNAME=''TRFLOGSTS'' AND A0.CDVAL=MST.STATUS
AND A1.CDTYPE=''SY'' AND A1.CDNAME=''TRFCODE'' AND A1.CDVAL=MST.TRFCODE
AND MST.TRFCODE IN (''SETRFCLOSE'',''SESENDWITHDRAW'',''SESENDDEPOSIT'',''SEREJECTWITHDRAW'',''SEREJECTDEPOSIT'',''SEODDLOT'',''SEODDLOC'')
AND MST.VERSION || MST.TRFCODE || MST.REFBANK || TO_CHAR(MST.TXDATE,''DDMMRRRR'') = MDL.JOINKEY(+)
AND MST.STATUS <> ''P''
AND MST.ERRCODE=ERR.ERRNUM(+)
','CRBVOUCHER','frmPRINT',null,null,null,50,'N',0,'NNNNYYNNNNY','Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'CRBVOUCHERSE';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (13,'EDITALLOW','Được sửa không','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'N','N','N',100,null,'Allow modify','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (12,'APRALLOW','Được duyệt không','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'N','N','N',100,null,'Allow approve','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'SENDTST','Thời điểm nhận','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'Y','Y','N',100,null,'Sent time','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (10,'CREATETST','Thời điểm tạo','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'Y','Y','N',100,null,'Created time','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (9,'ERRDESC','Diễn giải lỗi','C','CRBVOUCHERSE',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Error description','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (8,'DESC_STATUS','Trạng thái','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'Y','Y','N',100,null,'Status','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'SYMBOL','Mã CK','C','CRBVOUCHERSE',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Symbol','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'QTTY','Số lượng','N','CRBVOUCHERSE',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Quantity','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'REFBANK','Tham chiếu','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'Y','Y','N',100,null,'Bank','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (5,'DESC_TRFCODE','Loại','C','CRBVOUCHERSE',80,null,'LIKE,=',null,'Y','Y','N',120,null,'Type','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (4,'VOUCHERNO','Số bảng kê','C','CRBVOUCHERSE',150,null,'LIKE,=',null,'Y','N','Y',150,null,'Voucher No','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (3,'VERSION','Số TT','C','CRBVOUCHERSE',60,null,'LIKE,=',null,'N','Y','N',100,null,'Version','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'AFFECTDATE','Ngày hiệu lực','D','CRBVOUCHERSE',80,null,'>=,<=,=',null,'Y','Y','N',100,null,'Affect Date','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'TXDATE','Ngày','D','CRBVOUCHERSE',80,null,'>=,<=,=',null,'Y','Y','N',100,null,'Date','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (0,'AUTOID','Mã quản lý','N','CRBVOUCHERSE',80,null,'=',null,'N','N','N',80,null,'AutoID','N',null,null,'N',null,null,null,'N');
COMMIT;
/
