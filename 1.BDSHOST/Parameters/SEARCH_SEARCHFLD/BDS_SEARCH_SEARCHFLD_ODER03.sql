--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'ODER03';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('ODER03','Hoàn trả ứng trước tiền bán lệnh bán lỗi (8842)','Revert Advance Payment of error order (8842)','SELECT OD.TXDATE, OD.ORDERID, OD.CUSTODYCD, OD.AFACCTNO, OD.CIACCTNO, OD.RRTYPE, OD.CUSTBANK, OD.STAUTOID,
    OD.CODEID, OD.SYMBOL, OD.EXECTYPEVL, OD.EXECTYPE, OD.MATCHAMT, OD.CLEARDATE,
    OD.AAMT, OD.FEEAMT, OD.ADLAUTOID, OD.FULLNAME, OD.MBLOCK, GREATEST(CASE WHEN NVL(ODM.AAMT,0) > 0 AND OD.TXDATE = OD.ADTXDATE THEN OD.AAMT - OD.FEEAMT ELSE 0 end,0) VSDAMT
FROM
(
SELECT OD.TXDATE, OD.ORDERID, CF.CUSTODYCD, STS.AFACCTNO, STS.ACCTNO CIACCTNO, AD.RRTYPE, AD.CUSTBANK, AD.AUTOID STAUTOID,
    SB.CODEID, SB.SYMBOL, OD.EXECTYPE EXECTYPEVL, A.CDCONTENT EXECTYPE, OD.MATCHAMT, STS.CLEARDATE,
    ADL.AAMT, GREATEST(ROUND(ADL.AAMT * ADT.ADVRATE/36000 * (AD.CLEARDT - AD.TXDATE)), ADT.ADVMINFEE) FEEAMT,
    ADL.AUTOID ADLAUTOID, CF.FULLNAME, CI.MBLOCK, AD.TXDATE ADTXDATE
FROM STSCHD STS, ODMAST OD, CFMAST CF, AFMAST AF, SBSECURITIES SB, ALLCODE A, ADSCHD AD, ADSCHDDTL ADL, ADTYPE ADT, CIMAST CI
WHERE STS.AFACCTNO = AF.ACCTNO AND CF.CUSTID = AF.CUSTID
    AND STS.AFACCTNO = AD.ACCTNO AND AD.ADTYPE = ADT.ACTYPE
    AND AD.TXDATE = ADL.TXDATE AND AD.TXNUM = ADL.TXNUM
    AND ADL.ORDERID = OD.ORDERID AND CI.AFACCTNO = AF.ACCTNO
    AND STS.CODEID = SB.CODEID AND STS.ORGORDERID = OD.ORDERID
    AND STS.DUETYPE IN (''RM'') AND STS.DELTD = ''N''
    AND OD.ERROD = ''Y'' AND OD.ERRSTS = ''M''
    AND A.CDTYPE = ''OD'' AND A.CDNAME = ''EXECTYPE'' AND A.CDVAL = OD.EXECTYPE
    AND STS.AAMT >0 AND ADL.DELTD = ''N''
) OD
LEFT JOIN
(SELECT * FROM ODMAPEXT ODM WHERE ODM.ISVSD = ''Y'' AND ODM.AAMT > 0 UNION ALL SELECT * FROM ODMAPEXTHIST ODM WHERE ODM.ISVSD = ''Y'' AND ODM.AAMT > 0) ODM
ON OD.ORDERID = ODM.ORDERID
WHERE 0 = 0 ','ODMAST',null,'TXDATE DESC, CUSTODYCD, SYMBOL, ORDERID','8842',null,50,'N',30,'NYNNYYYNNN','Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'ODER03';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (19,'VSDAMT','Giá trị ƯT block của lệnh','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Advanced block amount','N','12',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (18,'MBLOCK','Giá trị ƯT block','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Advanced block amount','N','13',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (17,'ADLAUTOID','Số hiệu ƯT','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Schedule code','N','19',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (16,'FEEAMT','Giá trị phí','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Fee amount','N','11',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (15,'AAMT','Giá trị đã ứng trước','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Advance amount','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (14,'CLEARDATE','Ngày thanh toán','D','ODER03',100,null,'=',null,'Y','Y','N',100,null,'Clear date','N','21',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (13,'MATCHAMT','Giá trị khớp','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Match value','N','14',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (12,'EXECTYPE','Loại lệnh','C','ODER03',100,null,'LIKE,=',null,'Y','Y','N',100,'SELECT CDVAL VALUE, CDCONTENT DISPLAY FROM ALLCODE WHERE CDTYPE = ''OD'' AND CDNAME = ''EXECTYPE'' ORDER BY LSTODR','Order type','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'EXECTYPEVL','Loại lệnh','C','ODER03',100,null,'LIKE,=',null,'N','N','N',100,null,'Order type','N','22',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (10,'SYMBOL','Mã chứng khoán','C','ODER03',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Symbol','N','08',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (9,'CODEID','Mã code CK','C','ODER03',100,null,'LIKE,=',null,'N','N','N',100,null,'Codeid','N','07',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (8,'STAUTOID','Số hiệu lịch','N','ODER03',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Schedule code','N','09',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'RRTYPE','Nguồn','C','ODER03',100,null,'LIKE,=',null,'N','N','N',100,null,'Source','N','44',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'CUSTBANK','Mã ngân hàng','C','ODER03',100,null,'LIKE,=',null,'N','N','N',100,null,'Bank code','N','05',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (5,'CIACCTNO','Số TK CI','C','ODER03',100,null,'LIKE,=',null,'N','N','N',100,null,'CI acctno','N','04',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (4,'AFACCTNO','Số tiểu khoản','C','ODER03',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Afacctno','N','03',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (4,'FULLNAME','Họ tên','C','ODER03',100,null,'LIKE,=',null,'N','N','N',100,null,'Fullname','N','90',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (3,'CUSTODYCD','Số lưu ký','C','ODER03',100,null,'LIKE,=',null,'Y','Y','N',100,null,'Custody code','N','02',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'ORDERID','Số hiệu lệnh','C','ODER03',100,null,'LIKE,=',null,'Y','Y','Y',120,null,'OrderId','N','01',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'TXDATE','Ngày giao dịch','D','ODER03',100,null,'<,<=,=,>=,>,<>',null,'Y','Y','N',100,null,'Txdate','N','20',null,'N',null,null,null,'N');
COMMIT;
/
