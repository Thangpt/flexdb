--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'DF5000';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('DF5000','Trả nợ Deal ưu tiên dùng tiền phong tỏa trong deal',null,'
SELECT A.*, ROUND(fn_getamt4grpdeal(A.GROUPID,0,5)) SUMAMT, LEAST (ROUND(fn_getamt4grpdeal(A.GROUPID,0,5)),A.dfblockORG) dfblockamt,
        ROUND( LEAST(A.CIAVLWITHDRAW,(ROUND(fn_getamt4grpdeal(A.GROUPID,0,5))) - LEAST (ROUND(fn_getamt4grpdeal(A.GROUPID,0,5)),A.dfblockORG)),0) CIPAID,
        fn_getamt4grpdeal(A.GROUPID,0,6) INTMIN, fn_getamt4grpdeal(A.GROUPID,0,7) FEEMIN
FROM (
    SELECT v.AFACCTNO, v.GROUPID, v.LNACCTNO, v.SUMALLVALUE, v.ODDF, v.TA0DF, v.IRATE, v.CURAMT, v.CURINT,
v.CURFEE, v.INTPAIDMETHOD, v.RATE1, v.RATE2, v.CFRATE1, v.CFRATE2, v.MINTERM, v.PRINFRQ,
v.RLSDATE, v.DUEDATE, v.GOCPHAITRA, v.DUE, v.INTPAID, v.FEEPAID, v.TADF,
v.DFAMT, v.ODOVERDUEDF, v.ODDUEDF, v.ODSELLDF, v.VNDSELLDF, v.DDF, v.DOVERDUEDF, v.DDUEDF,
v.RTTDF, v.ODCALLRTTDF, v.ODCALLDF, v.VNDWITHDRAWDF, v.ADDVALUE, v.ODCALLSELLDF, cf.custodycd, cf.fullname, cf.idcode, cf.ADDRESS , df.orgamt, dfpaidamt, df.lrate, df.mrate,
         df.dfblockamt DFBLOCKORG,  greatest(getbaldeftrfamt (v.afacctno),getbaldefOVD (v.afacctno)) CIAVLWITHDRAW,

    CASE WHEN TO_DATE((SELECT VARVALUE FROM SYSVAR WHERE VARNAME=''CURRDATE''),''DD/MM/RRRR'') - TO_DATE(ln.RLSDATE,''DD/MM/RRRR'') >= ln.MINTERM THEN 0 ELSE
        ROUND( (v.CURAMT *   (LEAST(ln.Minterm, ln.PRINFRQ)* ln.RATE1 + GREATEST ( 0 , ln.MINTERM - ln.PRINFRQ) * ln.RATE2) ) /100/360,4) END INTM,
                        CASE WHEN TO_DATE((SELECT VARVALUE FROM SYSVAR WHERE VARNAME=''CURRDATE''),''DD/MM/RRRR'') - TO_DATE(ln.RLSDATE,''DD/MM/RRRR'') >= ln.MINTERM THEN 0 ELSE
    ROUND( (v.CURAMT *   (LEAST(ln.Minterm, ln.PRINFRQ)* ln.CFRATE1 + GREATEST ( 0 , ln.MINTERM - ln.PRINFRQ) * ln.CFRATE2) ) /100/360,4) END FEEM

    FROM v_getgrpdealformular v, afmast af, cfmast cf, dfgroup df,
       (
            SELECT LNM.ACCTNO, LEAST(LNM.MINTERM, TO_NUMBER( TO_DATE(LNS.OVERDUEDATE,''DD/MM/RRRR'') - TO_DATE(LNS.RLSDATE,''DD/MM/RRRR'')) )  MINTERM, LNS.RLSDATE,
                TO_DATE(lns.DUEDATE,''DD/MM/RRRR'') -  TO_DATE(lns.RLSDATE,''DD/MM/RRRR'') PRINFRQ,
                LNS.RATE1, LNS.RATE2, LNS.CFRATE1, LNS.CFRATE2, LNS.paid + LNS.intpaid + LNS.feeintpaid dfpaidamt FROM
                LNMAST LNM, LNSCHD LNS WHERE LNM.ACCTNO=LNS.ACCTNO AND LNS.REFTYPE=''P''
        ) LN
    where af.custid=cf.custid and v.afacctno=af.acctno and v.groupid=df.groupid and v.lnacctno=ln.acctno
) A WHERE 0=0 AND DFBLOCKORG > 0','DFGROUP',null,null,'2648',null,50,'N',30,'NYNNYYYNNN','Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'DF5000';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (20,'DESCRIPTION','Diễn giải','C','DF5000',100,null,'LIKE,=',null,'Y','N','N',100,null,'Description','N',null,null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (18,'CIPAID','Số tiền CI nộp thêm','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'CI deposit','N','19',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (18,'CIAVLWITHDRAW','Số tiền CI được rút','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'CI Avaiable withdraw','N','18',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (17,'DFBLOCKORG','Số tiền phong tỏa trong Deal','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'DF block Amount','N','23',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (17,'DFBLOCKAMT','Số tiền phong tỏa phải trả','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','Y','N','N',100,null,'DF block Amount','N','17',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (16,'SUMAMT','Tổng nợ','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Sum amt','N','22',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (16,'DEFAMT','Giá trị mặc định','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Sum amt','N','25',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (16,'RTTDF','Tỷ lệ thực tế','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0.###0','Y','N','N',100,null,'RTTDF','N','16',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (15,'LRATE','Tỷ lệ trigger','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0.###0','Y','N','N',100,null,'LRATE','N','15',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (14,'MRATE','Tỉ lệ cảnh báo','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0.###0','Y','N','N',100,null,'MRATE','N','14',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (13,'IRATE','Tỉ lệ an toàn','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0.###0','N','N','N',100,null,'IRATE','N','13',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (12,'TADF','Giá trị tài sản','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Asset value','N','12',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'FEEMIN','Nợ phí d.vụ min','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Current fee','N','21',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'CURFEE','Nợ phí d.vụ hiện tại','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Current fee','N','10',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (11,'INTMIN','Nợ lãi min','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Current interest','N','20',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (10,'CURINT','Nợ lãi hiện tại','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Current interest','N','09',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (9,'CURAMT','Nợ gốc hiện tại','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Current amount','N','08',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (8,'DFPAIDAMT','Giá trị vay đã trả','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','N','N','N',100,null,'Paid amount','N','07',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (7,'ORGAMT','Giá trị vay gốc','N','DF5000',100,null,'<,<=,=,>=,>,<>','#,##0','Y','Y','N',100,null,'Orginal loan amount','N','06',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (6,'GROUPID','Số deal tổng','C','DF5000',18,'cccc.cccccc.cccccc','LIKE,=','_','Y','Y','Y',120,null,'DF Account number','N','05',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (5,'ADDRESS','Địa chỉ','C','DF5000',100,null,'LIKE,=','_','Y','Y','N',100,null,'Address','N','59',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (4,'IDCODE','CMND','C','DF5000',100,null,'LIKE,=','_','Y','Y','N',100,null,'ID Code','N','58',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (3,'FULLNAME','Họ và tên','C','DF5000',100,null,'LIKE,=','_','Y','Y','N',100,null,'Custody CD','N','57',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (2,'AFACCTNO','Số Tiểu khoản','C','DF5000',120,null,'LIKE,=','_','Y','Y','N',100,null,'Account number','N','03',null,'N',null,null,null,'N');
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'CUSTODYCD','TK Lưu ký','C','DF5000',100,null,'LIKE,=','_','Y','Y','N',100,null,'Custody CD','N','02',null,'N',null,null,null,'N');
COMMIT;
/
