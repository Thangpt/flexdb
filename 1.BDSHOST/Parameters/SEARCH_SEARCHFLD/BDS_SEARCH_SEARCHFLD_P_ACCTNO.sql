--
--
/
DELETE SEARCH WHERE SEARCHCODE = 'P_ACCTNO';
INSERT INTO SEARCH (SEARCHCODE,SEARCHTITLE,EN_SEARCHTITLE,SEARCHCMDSQL,OBJNAME,FRMNAME,ORDERBYCMDSQL,TLTXCD,CNTRECORD,ROWPERPAGE,AUTOSEARCH,INTERVAL,AUTHCODE,ROWLIMIT,CMDTYPE)
VALUES ('P_ACCTNO','Quản lý tiểu khoản','Contract management','Select a.*, nvl(LIMITMAX,0)LIMITMAX ,nvl(USERHAVE,0)USERHAVE from
(SELECT CF.SHORTNAME, AF.ACTYPE,AFT.TYPENAME ACNAME, format_custid(AF.CUSTID) CUSTID,CF.FULLNAME FULLNAME,CF.FULLNAME CUSTNAME,
format_custodycd(CF.CUSTODYCD) CUSTODYCD,
CF.CUSTODYCD CUSTODYCD_SRCH,
format_subac(AF.ACCTNO) ACCTNO, AF.AFTYPE,A10.CDCONTENT TYPENAME, A1.CDCONTENT TRADEFLOOR,
A2.CDCONTENT TRADETELEPHONE,A3.CDCONTENT TRADEONLINE,AF.PIN,AF.TRADEPHONE,A5.CDCONTENT ALLOWDEBIT,AF.PHONE1,CF.IDCODE,CF.IDDATE, CF.IDPLACE,
AF.BANKACCTNO,AF.SWIFTCODE,AF.EMAIL,AF.ADDRESS,AF.FAX, A11.CDCONTENT ISOTC, A12.CDCONTENT VIA,
format_subac(AF.CIACCTNO) CIACCTNO,AF.IFRULECD,AF.LASTDATE,A8.CDCONTENT STATUS,
AF.MARGINLINE,AF.TRADELINE,AF.ADVANCELINE,AF.REPOLINE,AF.DEPOSITLINE,AF.BRATIO,A9.CDCONTENT TERMOFUSE,AF.DESCRIPTION,
AF.TELELIMIT,AF.ONLINELIMIT,AF.CFTELELIMIT,AF.CFONLINELIMIT,AF.TRADERATE,AF.DEPORATE,AF.MISCRATE, GRP.GRPNAME CAREBY, GRP.grpid CAREBYID, CF.REFNAME, AF.corebank,AF.bankname,
AF.MRIRATE,AF.MRMRATE,AF.MRLRATE,AF.MRDUEDAY,AF.MREXTDAY,AF.MRCLAMT,AF.MRCRLIMIT,AF.MRCRLIMITMAX,NVL(USF.ACCLIMIT,0) ACCLIMIT,
A0.cdcontent mrtype, A13.CDCONTENT COUNTRY
FROM AFMAST AF,CFMAST CF,AFTYPE AFT, TLGROUPS GRP,MRTYPE MRT, ALLCODE A0,
ALLCODE A1, ALLCODE A2,ALLCODE A3,ALLCODE A5,
ALLCODE A8,ALLCODE A9 ,ALLCODE A10 ,ALLCODE A11,ALLCODE A12, ALLCODE A13,
(SELECT * FROM USERAFLIMIT WHERE  TLIDUSER=''<$TELLERID>'' AND  TYPERECEIVE=''MR'') USF
WHERE AF.CUSTID=CF.CUSTID AND AF.ACTYPE=AFT.ACTYPE AND AFT.MRTYPE=MRT.ACTYPE
AND AF.ACCTNO =USF.ACCTNO (+)
AND AF.CAREBY = GRP.GRPID AND GRP.GRPTYPE = ''2''
AND AFT.ACTYPE = AF.ACTYPE
AND A0.CDTYPE = ''SA''   AND A0.CDNAME = ''MARGINTYPE''   AND A0.CDVAL = MRT.MRTYPE
AND A1.CDTYPE = ''SY'' AND A1.CDNAME = ''YESNO'' AND A1.CDVAL= AF.TRADEFLOOR
AND A2.CDTYPE = ''SY'' AND A2.CDNAME = ''YESNO'' AND A2.CDVAL= AF.TRADETELEPHONE
AND A3.CDTYPE = ''SY'' AND A3.CDNAME = ''YESNO'' AND A3.CDVAL= AF.TRADEONLINE
AND A5.CDTYPE = ''SY'' AND A5.CDNAME = ''YESNO'' AND A5.CDVAL = AF.ALLOWDEBIT
AND A8.CDTYPE = ''CF'' AND A8.CDNAME = ''STATUS'' AND A8.CDVAL = AF.STATUS
AND A9.CDTYPE = ''CF'' AND A9.CDNAME = ''TERMOFUSE'' AND A9.CDVAL = AF.TERMOFUSE
AND A10.CDTYPE = ''CF'' AND A10.CDNAME = ''AFTYPE''AND A10.CDVAL = AF.AFTYPE
AND A11.CDTYPE = ''SY'' AND A11.CDNAME = ''YESNO'' AND A11.CDVAL= AF.ISOTC
AND A12.CDTYPE = ''CF'' AND A12.CDNAME = ''VIA'' AND A12.CDVAL= AF.VIA
AND A13.CDTYPE = ''CF'' AND A13.CDNAME = ''COUNTRY'' AND A13.CDVAL= CF.COUNTRY
AND (SUBSTR(CF.CUSTID,1,4) = DECODE(''<$BRID>'', ''<$HO_BRID>'', SUBSTR(CF.CUSTID,1,4), ''<$BRID>'')
    OR AF.CAREBY IN (SELECT TLGRP.GRPID FROM TLGRPUSERS TLGRP WHERE TLID = ''<$TELLERID>'')))a
LEFT JOIN
(Select NVL(US.ACCTLIMIT,0) LIMITMAX,NVL(US.ALLOCATELIMMIT-US.USEDLIMMIT,0) USERHAVE
  from userlimit US where US.tliduser=''<$TELLERID>'') us on 0=0','AFMAST','frmAFMAST',null,null,null,50,'N',30,null,'Y','T');
COMMIT;
/
--
--
/
DELETE SEARCHFLD WHERE SEARCHCODE = 'P_ACCTNO';
INSERT INTO SEARCHFLD (POSITION,FIELDCODE,FIELDNAME,FIELDTYPE,SEARCHCODE,FIELDSIZE,MASK,OPERATOR,FORMAT,DISPLAY,SRCH,KEY,WIDTH,LOOKUPCMDSQL,EN_FIELDNAME,REFVALUE,FLDCD,DEFVALUE,MULTILANG,ACDTYPE,ACDNAME,FIELDCMP,FIELDCMPKEY)
VALUES (1,'CUSTODYCD_SRCH','Số TK lưu ký','C','P_ACCTNO',50,'cccc.cccccc','LIKE,=','_','N','Y','N',100,null,'Custody code','N',null,null,'N',null,null,null,'N');
COMMIT;
/
