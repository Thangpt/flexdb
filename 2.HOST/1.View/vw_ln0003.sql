CREATE OR REPLACE FORCE VIEW VW_LN0003 AS
(
SELECT TYPE,BANKCODE,sum(NML) NML, sum(INTAMT) INTAMT,sum(FEEAMT) FEEAMT,sum(TOTALAMT) TOTALAMT from(
SELECT
CASE WHEN LN.FTYPE ='DF' THEN 'DF' ELSE
(CASE WHEN LNS.REFTYPE ='GP' THEN 'BL' ELSE 'CL' END) END  TYPE,
CASE WHEN LN.RRTYPE = 'B' AND LN.CUSTBANK IS NOT NULL THEN NVL(CF.SHORTNAME,'')
ELSE 'BVSC' END BANKCODE,NML,INTAMT,FEEAMT, NML+INTAMT+FEEAMT TOTALAMT
FROM (
SELECT acctno,max(REFTYPE) REFTYPE ,sum(nml+ovd) NML,sum(intnmlacr + intovd +intdue+ intovdprin) INTAMT,
sum(feeintnmlacr+ feeintovdacr+ feeintnmlovd+ feeintdue) FEEAMT
FROM lnschd GROUP BY  acctno) LNS, LNMAST ln , cfmast cf
WHERE ln.acctno = lns.acctno
AND  LN.CUSTBANK = CF.CUSTID (+)) GROUP BY TYPE,BANKCODE

);

