CREATE OR REPLACE FORCE VIEW VW_BD_GETACCOUNTLOANINFO AS
(
SELECT CF.CUSTODYCD, LN.TRFACCTNO AFACCTNO, NVL(DF.ACCTNO,'----------------') DFACCTNO,
NVL(GREATEST(DF.INTAMTACR+DF.FEEAMT,DF.FEEMIN-DF.RLSFEEAMT),0) FEEAMT,
LN.INTNMLACR+LN.INTDUE + LN.OPRINNML+LN.PRINNML + LN.OINTNMLACR+LN.OINTOVDACR+ LN.OINTDUE+LN.FEE+LN.FEEDUE INDUEAMT,
LN.PRINOVD + LN.OPRINOVD+ LN.INTOVDACR+LN.INTNMLOVD + LN.OINTNMLOVD +LN.FEEOVD OVERDUEAMT,
NVL(DF.DFQTTY + DF.RCVQTTY + DF.CARCVQTTY + DF.BLOCKQTTY + DF.BQTTY,0) QTTY,
NVL(DFQTTY-NVL(V.SECUREAMT,0),0) TRADE,
LN.FTYPE, DF.DESCRIPTION, DF.SYMBOL, DF.DESC_DFTYPE, A1.CDCONTENT DESC_FTYPE
FROM (SELECT DFMAST.*, SB.SYMBOL, A0.CDCONTENT DESC_DFTYPE FROM DFMAST, SBSECURITIES SB, ALLCODE A0
WHERE SB.CODEID=DFMAST.CODEID AND A0.CDTYPE='DF' AND A0.CDNAME='DFTYPE' AND A0.CDVAL=DFMAST.DFTYPE) DF,
LNMAST LN, V_GETDEALSELLORDERINFO V, ALLCODE A1, AFMAST AF, CFMAST CF
WHERE LN.ACCTNO=DF.LNACCTNO  (+) AND DF.ACCTNO = V.DFACCTNO (+)
AND AF.ACCTNO=LN.TRFACCTNO AND AF.CUSTID=CF.CUSTID
AND A1.CDTYPE='LN' AND A1.CDNAME='FTYPE' AND A1.CDVAL=LN.FTYPE
)
;

