CREATE OR REPLACE VIEW VW_STRADE_MT_ACCOUNTS AS
SELECT MST.AUTOID REFID,MST.Cityef,MST.Citybank,MST.AFACCTNO,
 CASE WHEN af.CUSTID <> afm.custid AND MST.TYPE=0 THEN '3' ELSE MST.TYPE END TYPE,
(CASE WHEN MST.TYPE=1 THEN 'Ben ngoai' WHEN af.CUSTID <> afm.custid AND MST.TYPE=0 THEN 'Noi bo giua 2 TKLK' ELSE 'Noi bo' END) REG_TYPE,
(CASE WHEN MST.TYPE=1 THEN 'External' WHEN af.CUSTID <> afm.custid AND MST.TYPE=0 THEN 'Depoacc2Transfer' ELSE 'Internal' END) EN_REG_TYPE,
(CASE WHEN MST.TYPE=1 THEN MST.CUSTID ELSE AF.CUSTID END) REG_CUSTID,cf.custid,
(CASE WHEN MST.TYPE=1 THEN MST.BANKACC ELSE MST.CIACCOUNT END) REG_ACCTNO,
(CASE WHEN MST.TYPE=1 THEN MST.BANKACNAME ELSE TO_CHAR(AF.FULLNAME) END) REG_BENEFICARY_NAME,
(CASE WHEN MST.TYPE=1 THEN nvl(ba.full_name,MST.BANKNAME) ELSE 'ECC' END) REG_BENEFICARY_INFO,
FDEF.FEECD, FDEF.FEENAME, FDEF.FORP, FDEF.FEEAMT, FDEF.FEERATE, FDEF.MINVAL, FDEF.MAXVAL, FDEF.VATRATE,
(CASE WHEN MST.TYPE=1 THEN MST.acnidcode ELSE to_char(AF.idcode) END) acnidcode,
(CASE WHEN MST.TYPE=1 THEN MST.acniddate ELSE AF.iddate END) acniddate,
(CASE WHEN MST.TYPE=1 THEN MST.acnidplace ELSE to_char(AF.idplace) END) acnidplace,
cf.custodycd, var1.VARVALUE MTFRTIME, var2.VARVALUE MTTOTIME,
MST.bankid, nvl(mst.MNEMONIC,'') MNEMONIC, AF.CUSTODYCD REGCUSTODYCD, AF.CUSTODYCDTYPE
FROM CFOTHERACC MST, VW_STRADE_SUBACCOUNT_INFO AF, FEEMASTER FDEF , afmast afm, cfmast cf, sysvar var1, sysvar var2, bank_info ba
WHERE MST.CIACCOUNT=AF.AFACCTNO (+) AND MST.FEECD=FDEF.FEECD (+) and substr( nvl(mst.bankid,'AAA'),1,3) = ba.bank_no (+)
AND afm.acctno = mst.afacctno
AND cf.custid = afm.custid
and var1.grname = 'STRADE' and var1.varname = 'MT_FRTIME'
and var2.grname = 'STRADE' and var2.varname = 'MT_TOTIME';
