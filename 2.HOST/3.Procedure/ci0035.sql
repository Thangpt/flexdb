CREATE OR REPLACE PROCEDURE ci0035(
   PV_REFCURSOR   IN OUT   PKG_REPORT.REF_CURSOR,
   OPT            IN       VARCHAR2,
   BRID           IN       VARCHAR2,
   F_DATE         IN       VARCHAR2,
   T_DATE         IN       VARCHAR2,
   TXNUM          IN       VARCHAR2
 )
IS
--
-- PURPOSE: BRIEFLY EXPLAIN THE FUNCTIONALITY OF THE PROCEDURE
-- Bang ke uong truoc tien ban
-- MODIFICATION HISTORY
-- PERSON      DATE         COMMENTS
-- TruongLD   19-10-2011    CREATED
-- ---------   ------  -------------------------------------------
   V_STROPTION      VARCHAR2 (5);            -- A: ALL; B: BRANCH; S: SUB-BRANCH
   V_STRBRID        VARCHAR2 (4);                   -- USED WHEN V_NUMOPTION > 0
   V_FROMDATE       DATE;
   V_TODATE         DATE;
   V_TXNUM          VARCHAR2 (10);

BEGIN
   V_STROPTION := OPT;

   IF (V_STROPTION <> 'A') AND (BRID <> 'ALL')
   THEN
      V_STRBRID := BRID;
   ELSE
      V_STRBRID := '%%';
   END IF;

   -- GET REPORT'S PARAMETERS
   V_TXNUM    := TXNUM;
   V_TODATE   := To_date(T_DATE,'DD/MM/YYYY');

-- GET REPORT'S DATA
OPEN  PV_REFCURSOR FOR
    SELECT SCH.REFTXNUM || '/' || TO_CHAR(SCH.CLEARDT, 'RRRRMMYY') CONTRACTID, CF.CUSTID, CF.CUSTODYCD, AF.ACCTNO, CF.FULLNAME, CF.ADDRESS, CF.IDTYPE, CF.IDCODE, CF.IDDATE,
           CF.IDPLACE, SCH.CLEARDT, SCH.ODDATE, SCH.TXDATE, SCH.TXNUM,
           (TO_DATE(SCH.CLEARDT, 'DD/MM/RRRR') - TO_DATE(SCH.TXDATE,'DD/MM/RRRR')) ADVDAYS,
           SCH.AMT, (SCH.FEEAMT + SCH.BANKFEE) FEEAMT, (SCH.AMT + SCH.FEEAMT + SCH.BANKFEE) ADVAMT, SCH.Paidamt, SCH.REFTXNUM, SCH.REFTXDATE
    FROM CFMAST CF, AFMAST AF, ADSCHDTEMP SCH
    WHERE CF.CUSTID = AF.CUSTID AND AF.ACCTNO = SCH.ACCTNO
          AND SCH.STATUS = 'P' AND SCH.REFTXNUM =  V_TXNUM;

EXCEPTION
   WHEN OTHERS
   THEN
      RETURN;
END;                                                              -- PROCEDURE
/

