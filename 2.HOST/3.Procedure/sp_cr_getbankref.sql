CREATE OR REPLACE PROCEDURE sp_cr_getbankref (
    PV_REFCURSOR     IN OUT PKG_REPORT.REF_CURSOR,
    PV_STRBANKCODE   IN     VARCHAR2,
    PV_STRTXDATE     IN     VARCHAR2 DEFAULT NULL)
IS
    V_STRSQL   VARCHAR2 (2000);
    V_STRTXDATE VARCHAR2 (10);
BEGIN
    IF PV_STRTXDATE IS NULL THEN
       SELECT VARVALUE INTO V_STRTXDATE FROM SYSVAR WHERE GRNAME = 'SYSTEM' AND VARNAME ='CURRDATE';
    ELSE
       V_STRTXDATE := PV_STRTXDATE;
    END IF;

    V_STRSQL :=
           'SELECT ''09100''||TO_CHAR(TO_DATE('''
        || V_STRTXDATE
        || ''',''DD/MM/RRRR''),''YYMMDD'') || LPAD(SEQ_BANKREF'
        || PV_STRBANKCODE
        || '.NEXTVAL,6,0) REF FROM DUAL';

    OPEN PV_REFCURSOR FOR V_STRSQL;

EXCEPTION
    WHEN OTHERS
    THEN
        RETURN;
END;
/
