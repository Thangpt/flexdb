CREATE OR REPLACE PROCEDURE CF0024 (
   PV_REFCURSOR   IN OUT   PKG_REPORT.REF_CURSOR,
   OPT            IN       VARCHAR2,
   BRID           IN       VARCHAR2,
   F_DATE         IN       VARCHAR2,
   T_DATE         IN       VARCHAR2
 )
IS
--
-- PURPOSE: DSKH HUY, THAY DOI THONG TIN UY QUYEN
-- MODIFICATION HISTORY
-- PERSON      DATE      COMMENTS
-- QUOCTA   27-12-2011   CREATED - NOEL
-- ---------   ------  -------------------------------------------

   V_STROPTION         VARCHAR2  (5);
   V_STRBRID           VARCHAR2  (4);

   V_F_DATE            DATE;
   V_T_DATE            DATE;


BEGIN
   V_STROPTION := OPT;

   IF (V_STROPTION <> 'A') AND (BRID <> 'ALL')
   THEN
      V_STRBRID := BRID;
   ELSE
      V_STRBRID := '%%';
   END IF;

   -- GET REPORT'S PARAMETERS
   V_F_DATE        := TO_DATE(F_DATE, SYSTEMNUMS.C_DATE_FORMAT);
   V_T_DATE        := TO_DATE(T_DATE, SYSTEMNUMS.C_DATE_FORMAT);


   -- GET REPORT'S DATA

OPEN PV_REFCURSOR
FOR

     SELECT (CF.AUT1||CF.AUT2||CF.AUT3||CF.AUT4||CF.AUT5||CF.AUT6||CF.AUT7||CF.AUT8||CF.AUT9||CF.AUT10) LINKAUTH
FROM 
     (SELECT
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 1, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '1' ) END) AUT1,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 2, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '2' ) END) AUT2,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 3, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '3' ) END) AUT3,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 4, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '4' ) END) AUT4,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 5, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '5' ) END) AUT5,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 6, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '6' ) END) AUT6,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 7, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '7' ) END) AUT7,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 8, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '8' ) END) AUT8,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 9, 1)  = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '9' ) END) AUT9,
           (CASE WHEN SUBSTR(CFA.LINKAUTH, 10, 1) = 'Y' THEN (SELECT CDCONTENT FROM  ALLCODE AL WHERE AL.CDNAME ='LINKAUTH' AND AL.CDVAL = '10') END) AUT10,
           CF.FULLNAME ,AF.ACCTNO ,CF.CUSTODYCD  ,CF.IDCODE ,CF.IDDATE , CF.ADDRESS, CFA.FULLNAME  FULLNAMEAUTH ,CFA.LICENSENO ,CFA.VALDATE ,CFA.EXPDATE,
           CFA.ADDRESS ADDRESSAUT
     FROM  CFMAST CF, AFMAST AF, CFAUTH CFA, MAINTAIN_LOG ML
     WHERE CF.CUSTID  = AF.CUSTID
     AND   AF.ACCTNO  = CFA.ACCTNO
          
     ORDER BY AF.ACCTNO ,CF.SHORTNAME
     ) CF

;

EXCEPTION
   WHEN OTHERS
   THEN
      RETURN;
END;
/

