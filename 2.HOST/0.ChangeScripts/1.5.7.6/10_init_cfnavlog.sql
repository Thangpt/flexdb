DELETE cfnavlog WHERE 1 = 1;
INSERT INTO cfnavlog(txdate, custid, balance, advamt, etmassetamt, debtamt, navamt)
SELECT TXDATE, CUSTID, SUM(BALANCE), SUM(ADVAMT), SUM(ETMASSETAMT),
   SUM(DEPOFEEAMT + T0AMT + MRAMT + DFAMT),
   SUM(BALANCE + ADVAMT + ETMASSETAMT - (DEPOFEEAMT + T0AMT + MRAMT + DFAMT))
FROM (
   SELECT LOG.TXDATE, AF.ACCTNO, MAX(AF.CUSTID) CUSTID, MAX(LOG.BALANCE) BALANCE, 
          MAX(LOG.AVLADVANCE) ADVAMT, SUM(LOG.REALASS) ETMASSETAMT,
          MAX(LOG.DEPOFEEAMT) DEPOFEEAMT, MAX(LOG.T0AMT) T0AMT,
          MAX(LOG.MRAMT) MRAMT, MAX(LOG.DFAMT) DFAMT
   FROM TBL_MR3007_LOG LOG, AFMAST AF
   WHERE LOG.AFACCTNO = AF.ACCTNO
     AND AF.STATUS NOT IN ('C', 'N')
   GROUP BY LOG.TXDATE, AF.ACCTNO
)
GROUP BY TXDATE, CUSTID
HAVING SUM(BALANCE + ADVAMT + ETMASSETAMT - (DEPOFEEAMT + T0AMT + MRAMT + DFAMT)) <> 0;
COMMIT;
